(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[111],{3929:(e,n,a)=>{Promise.resolve().then(a.bind(a,8916))},8916:(e,n,a)=>{"use strict";a.r(n),a.d(n,{default:()=>N});var r=a(7296),t=a(4636),i=a(1873),s=a(7717),l=a(3233);function o(e){return e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")}let d=function(){for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];return globalThis.fetch(...n)};async function c(){let e=await d("/api/frames",{cache:"no-store"});if(!e.ok)throw Error("Failed to load frames");return(await e.json()).data.map(e=>{var n,a,r;return{id:e.id,name:e.name,slug:e.slug,domain:null!=(n=e.domain)?n:null,description:null!=(a=e.description)?a:null,createdAt:e.createdAt,roles:null!=(r=e.roles)?r:[]}})}async function u(e){var n;let{name:a,domain:r,description:t}=e,i=await d("/api/frames",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,domain:r,description:t})});if(!i.ok)throw Error(await i.text());let s=(await i.json()).data;return{...s,roles:null!=(n=s.roles)?n:[]}}async function m(e){let{id:n,...a}=e,r=await d("/api/frames?id=".concat(n),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok)throw Error(await r.text());return(await r.json()).data}async function x(e){let n=await d("/api/frames?id=".concat(e),{method:"DELETE"});if(!n.ok&&204!==n.status)throw Error(await n.text());return e}var f=a(9658),h=a(1793),p=a(1182),v=a(2692),y=a(4105),j=a(1555),A=a(6585),g=a(6194),w=a(5137),C=a(3351),b=a(758),S=a(4617),D=a(4915),E=a(6356),k=a(216),Q=a(6962);function N(){var e;let{data:n,isLoading:a,create:d,update:N,remove:z}=function(){let e=(0,i.jE)(),n=(0,s.I)({queryKey:["frames"],queryFn:c}),a=(0,l.n)({mutationFn:e=>u(e),onMutate:async n=>{var a,r;await e.cancelQueries({queryKey:["frames"]});let t=e.getQueryData(["frames"]),i={id:-1*Date.now(),name:n.name,slug:o(n.name),domain:null!=(a=n.domain)?a:null,description:null!=(r=n.description)?r:null,createdAt:new Date().toISOString(),roles:[]};return e.setQueryData(["frames"],function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[i,...e]}),{previous:t}},onError:(n,a,r)=>{(null==r?void 0:r.previous)&&e.setQueryData(["frames"],r.previous)},onSettled:()=>{e.invalidateQueries({queryKey:["frames"]})}}),r=(0,l.n)({mutationFn:e=>m(e),onMutate:async n=>{await e.cancelQueries({queryKey:["frames"]});let a=e.getQueryData(["frames"]);return e.setQueryData(["frames"],function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(e=>e.id===n.id?{...e,...n,slug:n.name?o(n.name):e.slug}:e)}),{previous:a}},onError:(n,a,r)=>{(null==r?void 0:r.previous)&&e.setQueryData(["frames"],r.previous)},onSettled:()=>{e.invalidateQueries({queryKey:["frames"]})}}),t=(0,l.n)({mutationFn:e=>x(e),onMutate:async n=>{await e.cancelQueries({queryKey:["frames"]});let a=e.getQueryData(["frames"]);return e.setQueryData(["frames"],function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(e=>e.id!==n)}),{previous:a}},onError:(n,a,r)=>{(null==r?void 0:r.previous)&&e.setQueryData(["frames"],r.previous)},onSettled:()=>{e.invalidateQueries({queryKey:["frames"]})}});return{...n,create:a,update:r,remove:t}}(),F=(0,f.S)(),[P,q]=t.useState(!1),[K,T]=t.useState(!1),[O,_]=t.useState(null),[I,R]=t.useState(null),[W,L]=t.useState({name:"",domain:"",description:""}),[M,J]=t.useState({name:"",domain:"",description:""}),Y=null!=n?n:[],H=null!=(e=Y.find(e=>e.id===I))?e:null;async function U(){H&&await F({title:"Delete Frame",description:'Are you sure you want to delete "'.concat(H.name,'"? This cannot be undone.'),confirmLabel:"Delete",destructive:!0})&&z.mutate(H.id,{onError:e=>_(e instanceof Error?e.message:"Delete failed"),onSuccess:()=>R(null)})}return(0,r.jsxs)(h.A,{sx:{display:"flex",gap:2,height:"calc(100vh - 120px)"},children:[(0,r.jsxs)(p.A,{variant:"outlined",sx:{width:320,display:"flex",flexDirection:"column"},children:[(0,r.jsxs)(h.A,{sx:{p:1.5,display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(v.A,{variant:"subtitle1",sx:{flex:1},children:"Frames"}),(0,r.jsx)(y.A,{size:"small",variant:"contained",onClick:()=>q(!0),children:"New"})]}),(0,r.jsx)(j.A,{}),(0,r.jsx)(h.A,{sx:{flex:1,overflowY:"auto"},children:a?(0,r.jsx)(h.A,{sx:{p:2,display:"flex",justifyContent:"center"},children:(0,r.jsx)(A.A,{size:24})}):(0,r.jsxs)(g.A,{dense:!0,children:[Y.map(e=>(0,r.jsx)(w.A,{selected:e.id===I,onClick:()=>R(e.id),children:(0,r.jsx)(C.A,{primary:e.name,secondary:e.domain})},e.id)),0===Y.length&&(0,r.jsx)(v.A,{sx:{p:2},color:"text.secondary",children:"No frames yet."})]})})]}),(0,r.jsx)(p.A,{variant:"outlined",sx:{flex:1,p:3,overflowY:"auto"},children:H?(0,r.jsxs)(b.A,{gap:2,children:[(0,r.jsxs)(h.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[K?(0,r.jsx)(S.A,{size:"small",label:"Name",value:M.name,onChange:e=>J(n=>({...n,name:e.target.value}))}):(0,r.jsx)(v.A,{variant:"h6",children:H.name}),(0,r.jsx)(h.A,{sx:{flex:1}}),!K&&(0,r.jsx)(y.A,{size:"small",onClick:function(){var e,n;H&&(J({name:H.name,domain:null!=(e=H.domain)?e:"",description:null!=(n=H.description)?n:""}),T(!0))},children:"Edit"}),!K&&(0,r.jsx)(y.A,{size:"small",color:"error",onClick:U,children:"Delete"}),K&&(0,r.jsx)(y.A,{size:"small",variant:"contained",disabled:N.isPending,onClick:function(){H&&(_(null),N.mutate({id:H.id,name:M.name.trim()||void 0,domain:M.domain.trim()||void 0,description:M.description.trim()||void 0},{onError:e=>_(e instanceof Error?e.message:"Update failed"),onSuccess:()=>T(!1)}))},children:"Save"}),K&&(0,r.jsx)(y.A,{size:"small",onClick:()=>T(!1),children:"Cancel"})]}),K?(0,r.jsx)(b.A,{direction:"row",gap:2,children:(0,r.jsx)(S.A,{size:"small",label:"Domain",value:M.domain,onChange:e=>J(n=>({...n,domain:e.target.value}))})}):(0,r.jsxs)(v.A,{variant:"body2",color:"text.secondary",children:["Domain: ",H.domain||"â€”"]}),K?(0,r.jsx)(S.A,{label:"Description",multiline:!0,minRows:3,value:M.description,onChange:e=>J(n=>({...n,description:e.target.value}))}):(0,r.jsx)(v.A,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:H.description||"No description."}),(0,r.jsx)(j.A,{}),(0,r.jsx)(v.A,{variant:"subtitle2",children:"Roles"}),0===H.roles.length&&(0,r.jsx)(v.A,{color:"text.secondary",variant:"body2",children:"No roles defined."}),!K&&H.roles.map(e=>(0,r.jsxs)(h.A,{sx:{display:"flex",gap:1,fontSize:14},children:[(0,r.jsx)("strong",{children:e.name}),(0,r.jsxs)("span",{children:["(",e.cardinality,")"]})]},e.name)),O&&(0,r.jsx)(v.A,{color:"error",variant:"body2",children:O})]}):(0,r.jsx)(h.A,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(v.A,{color:"text.secondary",children:"Select a frame to view details"})})}),(0,r.jsxs)(D.A,{open:P,onClose:()=>q(!1),maxWidth:"sm",fullWidth:!0,children:[(0,r.jsx)(E.A,{children:"New Frame"}),(0,r.jsx)(k.A,{children:(0,r.jsxs)(b.A,{gap:2,sx:{mt:1},children:[(0,r.jsx)(S.A,{label:"Name",value:W.name,autoFocus:!0,onChange:e=>L(n=>({...n,name:e.target.value}))}),(0,r.jsx)(S.A,{label:"Domain",value:W.domain,onChange:e=>L(n=>({...n,domain:e.target.value}))}),(0,r.jsx)(S.A,{label:"Description",value:W.description,multiline:!0,minRows:3,onChange:e=>L(n=>({...n,description:e.target.value}))})]})}),(0,r.jsxs)(Q.A,{children:[(0,r.jsx)(y.A,{onClick:()=>q(!1),children:"Cancel"}),(0,r.jsx)(y.A,{onClick:function(){W.name.trim()&&(_(null),d.mutate({name:W.name.trim(),domain:W.domain.trim()||void 0,description:W.description.trim()||void 0,roles:[]},{onError:e=>_(e instanceof Error?e.message:"Create failed")}),L({name:"",domain:"",description:""}),q(!1))},disabled:d.isPending||!W.name.trim(),variant:"contained",children:"Create"})]})]})]})}},9658:(e,n,a)=>{"use strict";a.d(n,{ConfirmationProvider:()=>x,S:()=>m});var r=a(7296),t=a(4636),i=a(4915),s=a(6356),l=a(216),o=a(2692),d=a(6962),c=a(4105);let u=t.createContext(null);function m(){let e=t.useContext(u);if(!e)throw Error("useConfirm must be used within a ConfirmationProvider");return e}function x(e){let{children:n}=e,[a,m]=t.useState(!1),[x,f]=t.useState({}),h=t.useRef(null),p=t.useCallback(e=>new Promise(n=>{h.current=n,f(e),m(!0)}),[]),v=e=>{m(!1);let n=h.current;h.current=null,n&&n(e)},{title:y="Confirm",description:j,confirmLabel:A="Confirm",cancelLabel:g="Cancel",destructive:w}=x;return(0,r.jsxs)(u.Provider,{value:p,children:[n,(0,r.jsxs)(i.A,{open:a,onClose:()=>v(!1),maxWidth:"xs",fullWidth:!0,children:[(0,r.jsx)(s.A,{children:y}),j&&(0,r.jsx)(l.A,{children:"string"==typeof j?(0,r.jsx)(o.A,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:j}):j}),(0,r.jsxs)(d.A,{children:[(0,r.jsx)(c.A,{onClick:()=>v(!1),children:g}),(0,r.jsx)(c.A,{onClick:()=>v(!0),color:w?"error":"primary",variant:w?"contained":"text",autoFocus:!0,children:A})]})]})]})}}},e=>{e.O(0,[386,608,182,540,358],()=>e(e.s=3929)),_N_E=e.O()}]);